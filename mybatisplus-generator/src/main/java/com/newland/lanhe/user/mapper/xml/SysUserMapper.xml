<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newland.lanhe.user.mapper.SysUserMapper">

    <select id="selectNotByRoleId" resultType="com.newland.lanhe.user.entity.SysUser">
        SELECT t.id, t.username, t.nick_name, t.gender, t.phone, t.email, t.enabled
        FROM sys_user t
        WHERE t.id NOT IN (SELECT user_id FROM sys_user_role sur WHERE sur.role_id = #{dto.roleId})
        <if test="blurry != null and blurry != ''">
            AND (
            t.username like CONCAT('%', #{dto.blurry}, '%')
            OR t.nick_name like CONCAT('%', #{dto.blurry}, '%')
            OR t.phone like CONCAT('%', #{dto.blurry}, '%')
            OR t.email like CONCAT('%', #{dto.blurry}, '%')
            )
        </if>
    </select>

    <select id="selectByRoleId" resultType="com.newland.lanhe.user.entity.SysUser">
        SELECT t.id, t.username, t.nick_name, t.gender, t.phone, t.email, t.enabled
        FROM sys_user t
        INNER JOIN sys_user_role sur ON t.id = sur.user_id
        WHERE sur.role_id = #{dto.roleId}
        <if test="blurry != null and blurry != ''">
            AND (
            t.username like CONCAT('%', #{dto.blurry}, '%')
            OR t.nick_name like CONCAT('%', #{dto.blurry}, '%')
            OR t.phone like CONCAT('%', #{dto.blurry}, '%')
            OR t.email like CONCAT('%', #{dto.blurry}, '%')
            )
        </if>
    </select>
</mapper>
